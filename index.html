<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Mundo TV - Login de Revendedor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --editor-bg: #1a1a1d;
            --editor-panel: #2c2f33;
            --editor-header: #99aab5;
            --editor-text: #ffffff;
            --editor-input-bg: #40444b;
            --editor-accent: #7289da;
            --editor-success: #43b581;
            --editor-error: #f04747;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background-color: var(--editor-bg);
            color: var(--editor-text);
        }
        #login-container { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; flex-direction: column; padding: 20px; }
        .login-box { background-color: var(--editor-panel); padding: 40px; border-radius: 8px; width: 100%; max-width: 450px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .login-box img { max-width: 120px; margin-bottom: 20px; }
        .login-box h2 { margin-top: 0; margin-bottom: 10px; }
        .login-box p { color: var(--editor-header); margin-bottom: 30px; }
        .login-input { width: 100%; background-color: var(--editor-input-bg); border: 1px solid transparent; border-radius: 5px; padding: 15px; color: var(--editor-text); font-size: 1rem; margin-bottom: 20px; }
        .login-button { width: 100%; background-color: var(--editor-accent); color: white; border: none; padding: 15px; border-radius: 5px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background-color 0.2s; }
        .login-button:hover { background-color: #677bc4; }
        .login-button:disabled { background-color: #505d8f; cursor: wait; }
        #error-message { color: var(--editor-error); margin-top: 15px; font-weight: 500; height: 20px; }
        #editor-container { display: none; width: 100%; height: 100%; flex-direction: row; }
        #controls { width: 400px; background-color: var(--editor-panel); height: 100%; overflow-y: auto; display: flex; flex-direction: column; padding: 10px; flex-shrink: 0; }
        #preview { flex-grow: 1; height: 100%; background-color: #fff; }
        #preview-frame { width: 100%; height: 100%; border: none; }
        details { border-bottom: 1px solid var(--editor-input-bg); margin-bottom: 15px; }
        summary { font-size: 1rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--editor-header); padding: 15px; cursor: pointer; list-style: none; display: flex; align-items: center; gap: 10px; }
        summary::-webkit-details-marker { display: none; }
        details[open] summary { color: var(--editor-accent); }
        .details-content { padding: 0 15px 15px 15px; }
        .control-item { display: flex; flex-direction: column; margin-bottom: 15px; }
        .control-item label { font-size: 0.9rem; margin-bottom: 5px; font-weight: 500; }
        .control-item input[type="text"], .control-item input[type="number"], .control-item textarea { background-color: var(--editor-input-bg); border: 1px solid transparent; border-radius: 5px; padding: 10px; color: var(--editor-text); font-family: 'Inter', sans-serif; font-size: 0.9rem; width: 100%; transition: border-color 0.2s; }
        .control-item input[type="color"] { width: 100%; height: 40px; border: none; padding: 0; cursor: pointer; background-color: transparent; }
        #export-button { background-color: var(--editor-success); color: white; border: none; padding: 15px; border-radius: 5px; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin: 20px; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #export-button:hover { background-color: #3aa072; }
    </style>
</head>
<body>

    <div id="login-container">
        <div class="login-box">
            <img src="https://daltv.site/logo.png" alt="Logo">
            <h2>Acesso de Revendedor</h2>
            <p>Use o usu치rio e senha do seu painel.</p>
            <form id="login-form">
                <input type="text" id="username-input" class="login-input" placeholder="Usu치rio do painel" required>
                <input type="password" id="password-input" class="login-input" placeholder="Senha do painel" required>
                <button type="submit" id="login-button" class="login-button">Entrar</button>
            </form>
            <p id="error-message"></p>
        </div>
    </div>

    <div id="editor-container">
        <aside id="controls">
            <div style="padding: 15px">
                <h2 style="margin: 0 0 5px 0;">Editor de P치gina</h2>
                <p style="margin: 0; color: var(--editor-header); font-size: 0.9rem;">Altere os campos e exporte seu site.</p>
            </div>
            
            <details open>
                <summary>丘뙖잺 Configura칞칫es Gerais</summary>
                <div class="details-content">
                    <div class="control-item">
                        <label for="whatsapp-number">Seu N췈 de WhatsApp (s칩 n칰meros)</label>
                        <input type="text" id="whatsapp-number" data-target="whatsapp-links" value="5511000000000">
                    </div>
                     <div class="control-item">
                        <label for="logo-url">URL da sua Logo</label>
                        <input type="text" id="logo-url" data-target="logo-img" value="https://daltv.site/logo.png">
                    </div>
                    <div class="control-item">
                        <label for="color-primary">Cor Principal</label>
                        <input type="color" id="color-primary" data-target="color" data-variable="--cor-primaria" value="#E91E63">
                    </div>
                </div>
            </details>
            
            <details>
                <summary>游꿟 T칤tulo Principal</summary>
                <div class="details-content">
                    <div class="control-item">
                        <label for="hero-title">T칤tulo da P치gina</label>
                        <textarea id="hero-title" data-target="hero-title" rows="3">O Universo do Entretenimento, Unificado.</textarea>
                    </div>
                     <div class="control-item">
                        <label for="hero-cta">Texto do Bot칚o</label>
                        <input type="text" id="hero-cta" data-target="hero-cta" value="QUERO TESTAR AGORA">
                    </div>
                </div>
            </details>
            
            <button id="export-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Exportar HTML
            </button>
        </aside>
        <main id="preview">
            <iframe id="preview-frame"></iframe>
        </main>
    </div>

    <script>
        const landingPageTemplate = `<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mundo TV</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet"><style>:root{--cor-primaria:{{COLOR_PRIMARY}};--cor-secundaria:#9C27B0;--texto-claro:#F0F0F0;--font-titulo:'Montserrat',sans-serif;--bg-principal:#121212;}*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:'Inter',sans-serif;background-color:var(--bg-principal);color:var(--texto-claro);line-height:1.6;overflow-x:hidden;background-image:radial-gradient(circle at top left,var(--cor-secundaria) 0%,transparent 25%),radial-gradient(circle at bottom right,var(--cor-primaria) 0%,transparent 25%);background-size:150% 150%;animation:gradient-anim 15s ease infinite}@keyframes gradient-anim{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}.hero{min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:20px}.hero-content h1{font-family:var(--font-titulo);font-weight:900;font-size:clamp(3rem,9vw,5.5rem);line-height:1.1;margin-bottom:40px;background:linear-gradient(45deg,var(--cor-primaria),var(--cor-secundaria));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.cta-button{display:inline-flex;align-items:center;gap:10px;background:linear-gradient(45deg,var(--cor-primaria),var(--cor-secundaria));color:#fff;padding:16px 32px;text-decoration:none;font-size:1.1rem;font-weight:700;border-radius:50px;box-shadow:0 5px 20px rgba(var(--cor-primaria-rgb),.4);transition:all .3s ease;border:none;cursor:pointer}.cta-button:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(var(--cor-primaria-rgb),.6)}footer{padding:40px 0;text-align:center;position:absolute;bottom:0;width:100%}footer .logo{max-width:80px;margin-bottom:10px;opacity:.8}</style></head><body><header class="hero"><div class="hero-content"><h1 data-editable="hero-title">{{HERO_TITLE}}</h1><a href="https://wa.me/{{WHATSAPP_NUMBER}}?text=Ol치!%20Quero%20um%20teste%20gr치tis." class="cta-button" target="_blank" data-whatsapp-link="true" data-editable="hero-cta">{{HERO_CTA}}</a></div></header><footer><img data-editable="logo-img" src="{{LOGO_URL}}" alt="Logo" class="logo"></footer><script>const r=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cor-primaria").substring(1,3),16),g=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cor-primaria").substring(3,5),16),b=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cor-primaria").substring(5,7),16);document.documentElement.style.setProperty("--cor-primaria-rgb",\`\${r}, \${g}, \${b}\`)<\/script></body></html>`;
        document.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('login-form');
            const loginContainer = document.getElementById('login-container');
            const editorContainer = document.getElementById('editor-container');
            const loginButton = document.getElementById('login-button');
            const usernameInput = document.getElementById('username-input');
            const passwordInput = document.getElementById('password-input');
            const errorMessage = document.getElementById('error-message');
            const AUTH_PROXY_URL = '/.netlify/functions/auth'; 
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();
                if (!username || !password) {
                    errorMessage.textContent = 'Preencha usu치rio e senha.';
                    return;
                }
                loginButton.disabled = true;
                loginButton.textContent = 'Verificando...';
                errorMessage.textContent = '';
                try {
                    const response = await fetch(AUTH_PROXY_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    const result = await response.json();
                    if (response.ok) {
                        loginContainer.style.display = 'none';
                        editorContainer.style.display = 'flex';
                        initEditor(); 
                    } else {
                        errorMessage.textContent = result.message || 'Usu치rio ou senha inv치lidos.';
                    }
                } catch (error) {
                    errorMessage.textContent = 'Erro ao conectar. Tente mais tarde.';
                } finally {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Entrar';
                }
            });
            function initEditor() {
                const iframe = document.getElementById('preview-frame');
                const controls = document.querySelectorAll('#controls [data-target]');
                const placeholders = new Map();
                controls.forEach(input => {
                    const key = input.id.replace(/-/g, '_').toUpperCase();
                    placeholders.set(key, input.id);
                });
                function getPopulatedTemplate() {
                    let populatedHTML = landingPageTemplate;
                    placeholders.forEach((inputId, key) => {
                        const inputElement = document.getElementById(inputId);
                        let value = inputElement.value;
                        const regex = new RegExp(`{{${key}}}`, 'g');
                        populatedHTML = populatedHTML.replace(regex, value);
                    });
                    return populatedHTML;
                }
                function updatePreview() {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    if (!iframeDoc) return;
                    controls.forEach(input => {
                        const targetId = input.dataset.target;
                        const value = input.value;
                        if (targetId === 'color') {
                            iframeDoc.documentElement.style.setProperty(input.dataset.variable, value);
                            const r = parseInt(value.substring(1, 3), 16), g = parseInt(value.substring(3, 5), 16), b = parseInt(value.substring(5, 7), 16);
                            iframeDoc.documentElement.style.setProperty('--cor-primaria-rgb', `${r}, ${g}, ${b}`);
                        } else if (targetId === 'whatsapp-links') {
                            iframeDoc.querySelectorAll('[data-whatsapp-link="true"]').forEach(link => {
                                const text = new URL(link.href).searchParams.get('text');
                                link.href = `https://wa.me/${value}?text=${encodeURIComponent(text)}`;
                            });
                        } else if (targetId === 'logo-img') {
                            const logo = iframeDoc.querySelector('[data-editable="logo-img"]');
                            if (logo) logo.src = value;
                        } else {
                            iframeDoc.querySelectorAll(`[data-editable="${targetId}"]`).forEach(el => {
                                el.innerHTML = value;
                            });
                        }
                    });
                }
                iframe.addEventListener('load', () => {
                     const initialHTML = getPopulatedTemplate();
                     iframe.contentWindow.document.open();
                     iframe.contentWindow.document.write(initialHTML);
                     iframe.contentWindow.document.close();
                     updatePreview();
                });
                controls.forEach(input => {
                    input.addEventListener('input', updatePreview);
                    input.addEventListener('change', updatePreview);
                });
                document.getElementById('export-button').addEventListener('click', () => {
                    const finalHtml = getPopulatedTemplate();
                    const blob = new Blob([finalHtml], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'index.html';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                });
                iframe.src = 'about:blank';
            }
        });
    </script>
</body>
</html>
